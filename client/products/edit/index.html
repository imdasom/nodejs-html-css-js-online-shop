<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.5/dist/web/static/pretendard.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="/client/layout/index.css">
    <link rel="stylesheet" href="/client/products/edit/index.css">
    <link rel="stylesheet" href="/client/products/list/index.css">
    <!--  layout  -->
    <script src="/client/layout/index.js"></script>
    <!--  common  -->
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dayjs/1.11.7/dayjs.min.js"></script>
    <title>어드민 사이트</title>
    <meta name="description" content="Vanilla HTML+CSS+JS">
</head>
<body>
<div>
    <header>
        <img src="https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FeyPIsT%2FbtqBO74U3Ky%2FjNO3yCYab0xoG7w4VsAiAk%2Fimg.jpg" width="150" />
        <button class="primary">로그아웃</button>
    </header>
    <main>
        <nav>
            <div class="menu-item open">
                <div class="menu-item-title"><div>상품 관리</div><div class="open">-</div><div class="closed">+</div></div>
                <div class="menu-child-wrap">
                    <a class="menu-child active" href="/client/products/list/index.html">상품관리</a>
                    <a class="menu-child" href="/client/categories/list/index.html">카테고리관리</a>
                </div>
            </div>
            <div class="menu-item">
                <div class="menu-item-title"><div>정책 관리</div><div class="open">-</div><div class="closed">+</div></div>
                <div class="menu-child-wrap">
                    <a class="menu-child" href="/client/point-policy/list/index.html">포인트정책관리</a>
                    <a class="menu-child" href="/client/coupon-policy/list/index.html">쿠폰정책관리</a>
                    <a class="menu-child" href="/client/stamp-policy/list/index.html">스탬프정책관리</a>
                </div>
            </div>
        </nav>
        <div class="page-container list-page">
            <div class="page-title">
                상품수정
            </div>
            <div>
                <table class="content">
                    <tbody>
                        <tr>
                            <th>아이디</th>
                            <td><input type="text" class="id" readonly/></td>
                        </tr>
                        <tr>
                            <th>상품명</th>
                            <td><input type="text" class="name" /></td>
                        </tr>
                        <tr>
                            <th>대표이미지</th>
                            <td class="form-item left"><img class="image" width="100" height="100" style="margin: 10px" /></td>
                        </tr>
                        <tr>
                            <th>카테고리</th>
                            <td>
                                <select class="category">
                                    <option value="FOOD">식품</option>
                                    <option value="DRINKS">음료</option>
                                    <option value="COSMETIC">뷰티</option>
                                    <option value="APPAREL">의류</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <th>가격</th>
                            <td><input type="text" class="price"/></td>
                        </tr>
                        <tr>
                            <th>상태</th>
                            <td class="form-item left">
                                <div class="form-radio"><input type="radio" class="status" name="status" value="READY" id="status-READY" /><label for="status-READY">판매대기</label></div>
                                <div class="form-radio"><input type="radio" class="status" name="status" value="ON_SALE" id="status-ON_SALE" /><label for="status-ON_SALE">판매중</label></div>
                                <div class="form-radio"><input type="radio" class="status" name="status" value="SALE_END" id="status-SALE_END" /><label for="status-SALE_END">판매종료</label></div>
                            </td>
                        </tr>
                        <tr>
                            <th>포인트정책</th>
                            <td>
                                <div class="form-point-policy">
                                    <input type="text" class="pointPolicyId" readonly />
                                    <button class="inner-action-button">변경</button>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <th>생성일</th>
                            <td class="createdAt form-item left"></td>
                            <th>수정일</th>
                            <td class="updatedAt form-item left"></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="action-button-wrap">
                <button class="default action-button cancelButton">취소</button>
                <div>
                    <button class="danger action-button deleteButton">삭제</button>
                    <button class="primary action-button submitButton">저장</button>
                </div>
            </div>
        </div>
    </main>
</div>
</body>
<script type="text/javascript">
  $(function(){
    const id = (new URL(location.href)).searchParams.get('id');
    fetch(`/api/products/${id}`, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
        'Content-Type': 'application/json'
      }
    }).then(function (response) {
      return response.json();
    }).then(function (data) {
      document.querySelector('.id').value = data.id;
      document.querySelector('.name').value = data.name;
      document.querySelector('.image').src = data.imageUrls[0];
      document.querySelector('.createdAt').textContent = dayjs(data.createdAt).format('YYYY.MM.DD HH:mm:ss');
      document.querySelector('.updatedAt').textContent = dayjs(data.updatedAt).format('YYYY.MM.DD HH:mm:ss');
      document.querySelector('.category').value = data.category;
      document.querySelector('.price').value = data.price;
      document.querySelectorAll('.status').forEach(element => {
        element.checked = element.value === data.status;
      });
      document.querySelector('.pointPolicyId').dataset.id = data.pointPolicyId;
      document.querySelector('.pointPolicyId').value = '포인트정책명';
    }).catch(function (err) {
      console.error(err);
    });

    document.querySelector('.cancelButton').addEventListener('click', function onClickCancel() {
      if (confirm('수정사항이 반영되지 않아요. 페이지를 나갈까요?')) {
        window.location.href = '/client/products/list/index.html';
      }
    });

    document.querySelector('.deleteButton').addEventListener('click', function onClickCancel() {
      if (confirm('정말 삭제하시겠습니까?')) {
        fetch(`/api/products/${id}`, {
          method: 'DELETE',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          }
        }).then(function () {
          window.location.href = '/client/products/list/index.html';
          alert('삭제되었습니다.');
        });
      }
    });

    document.querySelector('.submitButton').addEventListener('click', function onClickSubmit() {
      window.location.href = '/client/products/list/index.html';
      alert('수정되었습니다');
    });
  });
</script>
</html>
